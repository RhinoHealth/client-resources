# Generalized Compute Example - Run Encrypted Code
<br/>

### **Description**

This example provides files that can be used with the Rhino Health Generalized Compute capability to locally encrypt code and then remotely run it on a Rhino Client.

It shows how to:
* Locally encrypt the code that you would like to have run
* Build a container image using just the encrypted code (and not the source code)
* Have the container execute the encrypted code, using the decryption key as an input parameter provided during run time

Please reference the User Documentation and/or Tutorials for in depth explanations on how to use the Generalized Compute capability.
<br/><br/>

### **Resources**
- `generate_key.py` - A script for generating a new encryption key using the python cryptography.fernet library
- `encrypt_code.py` - A script for encrypting input code with an input encryption key using the python cryptography.fernet library
- `dataprep.py` - An example script to be run (encrypted) remotely. This file converts DICOM to jpg, performs data imputation on `Height` and `Weight` fields and calculates BMI (this is the code used in Tutorial 1 for data prep)
- `Dockerfile` - This is the Dockerfile to be used for building the container image. Note that it doesn't copy in dataprep.py, but rather only the dataprep_enc file
- `decrypt_code.py` - This script runs within the container and decrypts the code using a decryption key provided as a run time parameter when triggering the code run 
- `run_encrypted_code.sh` - The entrypoint shell script for the docker container, which runs decrypt_code.py to decrypt the code and then execute it
- `requirements.txt` - The python requirements for this project
- `dataprep_enc` - an example of encrypted code generated by running `encrypt_code.py` on the `dataprep.py` file
<br><br>

### **Instructions**
1. Generate a new encryption key to be used for this code - it is stored locally so only you have access to this key: `python generate_key.py ~/myprecious`
2. Encrypt the code to be run (in our example `dataprep.py`) using the encryption key: `python encrypt_code.py ./dataprep.py ~/myprecious dataprep_enc`
3. (Optional) You can now delete the `dataprep.py` file (or move it to a different directory) - it will not be used when building the container image, but if you want to validate this you can delete/move this file
4. Build the container image from the Dockerfile: `../../../rhino-utils/docker-push.sh rhino-gc-workgroup-my-workgroup data-prep-secure`
5. Create a Model object in FCP using this container image in the Rhino Health UI or via the SDK
6. Run this model passing in the encryption key (which also acts as a decryption key in this case since fernet is a symmetric encryption) as a secret run parameter with the name `key`: `{"key": "YOUR_KEY"}`

Note that this example uses fernet as the encryption mechanism, but any other encryption mechanism can be used.
<br><br>

# Getting Help
For additional support, please reach out to [support@rhinohealth.com](mailto:support@rhinohealth.com).
